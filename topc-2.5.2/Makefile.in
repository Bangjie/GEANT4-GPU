# @configure_input@
# cd ROOT_DIR; autoscan; mv autoconf.scan configure.in; autoconf; ./configure

# For debugging with gcc/gdb, re-make after:  env CFLAGS="-g3 -O0" ./configure
# (defines macros for gdb)
# For testing portability, re-make after:  env "CFLAGS=-Wall -W" ./configure
# For alternate C compiler, re-make after:
#                           env CC=cc ./configure --cache-file=/dev/null

prefix=@prefix@
exec_prefix=@exec_prefix@

@SET_MAKE@

default: source

source:
	( cd src; ${MAKE} )

examples: source
	( cd bin; ${MAKE} all )

check: source
	@ echo "*** WARNING:  Some of these tests may take a little while"
	( cd bin; ${MAKE} checkall | grep TEST )

install: source
	@test -d @bindir@ || mkdir -p @bindir@
	cp bin/topc-config @bindir@/
	cp bin/topcc @bindir@/
	cp bin/topc++ @bindir@/
	@test -d @includedir@ || mkdir -p @includedir@
	cp include/*.h @includedir@/
	@test -d @libdir@ || mkdir -p @libdir@
	cp lib/lib*.a @libdir@
	@test -d @mandir@ || mkdir -p @mandir@
	@test -d @mandir@/man1 || mkdir -p @mandir@/man1
	cp doc/topcc.1 @mandir@/man1/
	cp doc/topc++.1 @mandir@/man1/
	@test -d @infodir@ || mkdir -p @infodir@
	cp doc/topc.info* @infodir@/
	test @infodir@ = /usr/local/info && \
	  install-info --section Development Development @infodir@/topc.info

uninstall:
	rm -f @bindir@/topc-config
	rm -f @bindir@/topcc
	rm -f @bindir@/topc++
	rm -f @includedir@/topc.h
	rm -f @includedir@/mpinu.h
	rm -f @libdir@/libtopc*.a
	rm -f @libdir@/libmpinu.a
	rm -f @mandir@/man1/topcc.1
	rm -f @mandir@/man1/topc++.1
	rm -f @infodir@/topc.info*
	install-info --remove topc

clean:
	( cd src; ${MAKE} clean )
	( cd bin; ${MAKE} clean )
	( cd doc; ${MAKE} clean )
	( cd lib; rm -f lib* )
	( cd include; rm -f *.h )

distclean: clean
	( cd src; ${MAKE} distclean )
	( cd bin; ${MAKE} distclean )
	( cd doc; ${MAKE} distclean )
	rm config.*
	rm -f README Makefile \
	      bin/Makefile bin/topcc bin/topc++ bin/topc-config \
	      doc/Makefile doc/topcc.1 doc/topc-version.texi \
	      src/Makefile src/mpinu/Makefile src/mpinu/procgroup \
	      utils/ssh-procgroup utils/ssh-killall
	rm -rf autom4te.cache

maintainer-clean:
	( cd doc; ${MAKE} maintainer-clean )
	${MAKE} distclean

# If not in ./topc, do "mv ...; tar ...; mv ..."
dist: distclean
	name=`basename $$PWD`; \
	version=@TOPC_VERSION@; \
	if [ "$$name" != "topc-$$version" ] ; then \
	  echo "main dir, $$name, not same as topc-$$version" ; \
	  exit 1; \
	fi; \
	( cd @PWD@/..; \
	  tar cvf topc-$$version.tar ./topc-$$version; \
	  gzip topc-$$version.tar; ); \
	ls -l ../topc-$$version.tar.gz
