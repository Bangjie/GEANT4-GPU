\documentclass[12pt]{article}

% Packages
\usepackage[margin=1.2in]{geometry}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{float}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{titling}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{hyperref}
\usepackage{makecell}
\usepackage{caption}
\usepackage{array}
\usepackage[parfill]{parskip}

% Comments --------------------------------------------------------------------
\usepackage{xcolor}
\newif\ifcomments\commentstrue
\ifcomments \newcommand{\authornote}[3]{\textcolor{#1}{[#3 ---#2]}}
\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}} \else
\newcommand{\authornote}[3]{} \newcommand{\todo}[1]{} \fi
\newcommand{\wss}[1]{\authornote{magenta}{SS}{#1}}
\newcommand{\ds}[1]{\authornote{blue}{DS}{#1}}
% End Comments ---------------------------------------------------------------

% Formatting
\setlength{\parindent}{0pt}
\captionsetup[table]{skip=2pt}

% Title Page -----------------------------------------------------------------
\title{
\LARGE GEANT-4 GPU Port:
\\\vspace{10mm}
\large \textbf{Design Document: Detailed Design}
\vspace{40mm}
}
\author{
\textbf{Team 8}
\\Stuart Douglas -- dougls2
\\Matthew Pagnan -- pagnanmm
\\Rob Gorrie -- gorrierw
\\Victor Reginato -- reginavp
\vspace{10mm}
}
\date{\vfill \textbf{Detailed Design: Version 0}\\ \today}
% End Title Page -------------------------------------------------------------


% ============================== BEGIN DOCUMENT ============================= %
\begin{document}
\pagenumbering{gobble} % start numbering after TOC

% ============================== Title Page ============================= %
\maketitle
\newpage

% ================================= TOC ================================= %
\renewcommand{\contentsname}{Table of Contents}
\tableofcontents
\newpage
\pagenumbering{arabic}

\section{Introduction}
\subsection{Revision History}
All major edits to this document will be recorded in the table below.

\begin{table}[h]
\centering
\caption{Revision History}\label{Table_Revision}
\begin{tabular}{lll}

\toprule
\bf Description of Changes & \bf Author & \bf Date\\\midrule
\arrayrulecolor{lightgray}
Set up sections and filled out Introduction section & Matthew & 2015-12-15\\\hline
Added sections for Errors and Key Algorithms & Stuart & 2016-01-08\\
\arrayrulecolor{black}
\bottomrule
\end{tabular}
\end{table}

\subsection{Document Structure \& Template}
The design documentation for the project is broken into two main documents.

The system architecture document details the system architecture, including an overview of the modules that make up the system, analysis of aspects that are likely and unlikely to change, reasoning behind the high-level decisions, and a table showing how each requirement is addressed in the proposed design.

This detailed design document covers the specifics of several key modules in the project. For each module, an MIS is given fully detailing the interface of the module. Then, the methods for handling errors within the module are discussed, and finally the main algorithms and data structures used by the module are presented.

\subsection{List of Tables}
\begin{center}
\begin{tabular}{cl}
\toprule
\bf Table \# & \bf Title\\\midrule
\arrayrulecolor{lightgray}
\ref{Table_Revision} & Revision History\\\hline
\ref{Table_NeutronHPDataPointInterface} & G4NeutronHPDataPoint -- access program syntax\\\hline
\ref{Table_NeutronHPDataPointSemantics} & G4NeutronHPDataPoint -- access program semantics\\\hline
\ref{Table_NeutronHPDataPointStateVariables} & G4NeutronHPDataPoint -- state variables\\\hline
\ref{Table_NeutronHPVectorInterface} & G4NeutronHPVector -- access program syntax\\\hline
\ref{Table_NeutronHPVectorSemantics} & G4NeutronHPVector -- access program semantics\\\hline
\ref{Table_NeutronHPDataPointStateVariables} & G4NeutronHPVector -- state variables\\\hline
\ref{Table_CMakeStateVariables} & CMake Files -- state variables\\
\arrayrulecolor{black}
\bottomrule
\end{tabular}
\end{center}

\subsection{Note About G4 variables}
Geant4 uses its own basic types for standard C++ types (G4int, G4bool, G4double, etc). These types are currently just \texttt{typedefs} to the respective type as defined in the system libraries.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ----- NeutronHPDataPoint
\section{G4NeutronHPDataPoint}
\subsection{Description}
This class encapsulates all of the data as well as the accessor and mutator methods that each point requires. The points contain two private variables used to store the xSec and the energy as doubles. This class also contains the constructors needed to instantiate this data type.

\subsection{MIS (Module Interface Specification)}
\subsubsection{Access Program Syntax}% ================ Victor
\begin{table}[H]
\caption{G4NeutronHPDataPoint -- access program syntax}\label{Table_NeutronHPDataPointInterface}
\begin{tabular}{llll}
\toprule
\bf Routine Name & \bf Input & \bf Output & \bf Exceptions \\ \midrule
\arrayrulecolor{lightgray}
G4NeutronHPDataPoint &  &  &  \\\hline
G4NeutronHPDataPoint & G4double, G4double &  & \\\hline
= & G4NeutronHPDataPoint &  & \\\hline
GetEnergy & & G4double &  \\\hline
GetXsection & & G4double &  \\\hline
SetEnergy & G4double & & \\\hline
SetXsection & G4double & & \\\hline
GetX & & G4double &  \\\hline
GetY & & G4double &  \\\hline
SetX & G4double & & \\\hline
SetY & G4double & & \\\hline
SetData & G4double, G4double & &\\
\arrayrulecolor{black}
\bottomrule
\end{tabular}
\end{table}

\subsubsection{Access Program Semantics}% =========== Victor
Note that hyphens in routine names and inputs are just for linebreaks due to the table size. The actual routine names and inputs do not have hyphens.

\begin{table}[H]
\caption{NeutronHPDataPoint -- access program semantics}\label{Table_NeutronHPDataPointSemantics}
\begin{tabular}{l p{0.17\textwidth} p{0.5\textwidth}}
\toprule
\bf Routine Name & \bf Input & \bf Semantics \\\midrule
\arrayrulecolor{lightgray}
G4NeutronHPDataPoint  &                      & instantiates the class, setting \texttt{energy} and \texttt{xSec} to 0\\\hline
G4NeutronHPDataPoint  & G4double, G4double   & instantiates the class with the inputted \texttt{energy} and \texttt{xSec}\\\hline
=                     & G4NeutronHP-DataPoint& sets the \texttt{energy} and \texttt{xSec} of the instance to those of the input \\\hline
GetEnergy             &                      & returns \texttt{energy} of the instance \\\hline
GetXsection           &                      & returns the \texttt{xSec} of the instance\\\hline
SetEnergy             & G4double             & sets \texttt{energy} of instance to the argument\\\hline
SetXsection           & G4double             & sets \texttt{xSec} of instance to the argument\\\hline
GetX                  &                      & returns the \texttt{energy} of the instance\\\hline
GetY 				  &                      & returns the \texttt{xSec} of the instance\\\hline
SetX				  & G4double             & sets \texttt{energy} of instance to the argument\\\hline
SetY				  & G4double             & sets \texttt{xSec} of instance to the argument \\\hline
SetData				  & G4double, G4double   & sets instance's \texttt{energy} and \texttt{xSec} to the passed arguments\\
\arrayrulecolor{black}
\bottomrule
\end{tabular}
\end{table}

\subsubsection{State Variables}% ================== Matt
The following variables maintain state for the class, and are all private to the module.

\begin{table}[h]
\caption{G4NeutronHPDataPoint -- state variables}\label{Table_NeutronHPDataPointStateVariables}
\begin{tabularx}{\textwidth}{llX}
\toprule
\bf Variable & \bf Type & \bf Description\\\midrule
\arrayrulecolor{lightgray}
\texttt{energy} & G4double & the energy of the particle \\\hline
\texttt{xSec}   & G4double & the cross-section of the particle \\
\arrayrulecolor{black}
\bottomrule
\end{tabularx}
\end{table}

\subsubsection{Environment Variables}% ============== Matt
There are no environment variables for this module.

\subsubsection{Assumptions}% ==================== Stuart	
It can be assumed that the class will be initialized. As such, all getter methods will return a non-null value.

\subsection{Error Handling}
NA

\subsection{Key Algorithms}
NA
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ---- NeutronHPDataPoint


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ----- NeutronHPVector
\section{G4NeutronHPVector}

\subsection{Description}
G4NeutronHPVector

\subsection{MIS (Module Interface Specification)}
Note that hyphens in routine names, inputs, outputs, and exceptions are just for linebreaks due to the table size. The actual routine names, inputs, outputs, and exceptions do not have hyphens.

\subsubsection{Access Program Syntax}% ================ Victor
\begin{longtable}{p{0.28\textwidth}p{0.28\textwidth}p{0.28\textwidth}p{0.14\textwidth}}
\caption{G4NeutronHPVector -- access program syntax}\label{Table_NeutronHPVectorInterface}\\
\toprule
\bf Routine Name & \bf Input & \bf Output & \bf Exceptions \\\midrule
\arrayrulecolor{lightgray}
G4NeutronHPVector & & & \\\hline
G4NeutronHPVector & G4int & & \\\hline
= & G4NeutronHPVector\& & G4NeutronHPVector\& &\\\hline
+ & G4NeutronHPVector\&, G4NeutronHPVector\& & G4NeutronHPVector\& &\\\hline
SetVerbose & G4int & & \\\hline
Times &G4double & & \\\hline
SetPoint  &G4int, G4NeutronHPDataPoint & & \\\hline
SetData & G4int, G4double,G4double& & \\\hline
SetX & G4int, G4double & & \\\hline
SetEnergy & G4int, G4double & & \\\hline
SetY & G4int, G4double & & \\\hline
SetXsec & G4int, G4double & & \\\hline
GetEnergy & G4int & G4double & \\\hline
GetXsec & G4int & G4double & \\\hline
GetXsec & G4double & G4double & \\\hline
GetXsec & G4double,G4int & G4double & \\\hline
GetX & G4int & G4double & \\\hline
GetY & G4double & G4double & \\\hline
GetY & G4int & G4double & \\\hline
GetVectorLength & & G4int & \\\hline
GetPoint & G4int & const G4NeutronHPDataPoint\& & \\\hline
Hash & & & \\\hline
ReHash & & & \\\hline
InitInterpolation & istream & & \\\hline
Init & istream,G4int, G4double, G4double& & \\\hline
Init & istream, G4double,G4double & & \\\hline
ThinOut & G4double & & \\\hline
SetLabel & G4double & & \\\hline
GetLabel & & G4double & \\\hline
CleanUp & & & \\\hline
Sample & & G4double & \\\hline
Debug & & G4double * & \\\hline
Merge & G4NeutronHPVector *,  G4NeutronHPVector *& & \\\hline
Merge & G4InterpolationScheme, G4double, G4NeutronHPVector *, G4NeutronHPVector * & &\\\hline
SampleLin & & G4double & \\\hline
IntegrateAndNormalise & & & \\\hline
Integrate & & & \\\hline
GetIntegral & & G4double & \\\hline
SetInterpolationManager & const G4InterpolationManager \& & & \\\hline
SetInterpolationManager & G4InterpolationManager \& & & \\\hline
SetScheme & G4int,const G4InterpolationScheme \& & & \\\hline
GetScheme & G4int & G4InterpolationScheme & \\\hline
GetMeanX & & G4double & \\\hline
GetBlocked & & vector\textless G4double\textgreater & \\\hline
GetBuffered & & vector\textless G4double\textgreater & \\\hline
Get15percentBorder & & G4double & \\\hline
Get50percentBorder & & G4double & \\
\arrayrulecolor{black}
\bottomrule
\end{longtable}

\subsubsection{Access Program Semantics}% ============ Rob
Note that hyphens in routine names and inputs are just for linebreaks due to the table size. The actual routine names and inputs do not have hyphens.

\begin{longtable}{p{0.25\textwidth}p{0.25\textwidth}p{0.5\textwidth}}
\caption{G4NeutronHPVector -- access program semantics}\label{Table_NeutronHPVectorSemantics}\\
\toprule
\bf Routine Name & \bf Input & \bf Description \\\midrule
\arrayrulecolor{lightgray}
G4NeutronHPVector & & A constructor for the G4NeutronHPVector class. Instantiates the class with no parameters\\ \hline
G4NeutronHPVector & G4int &  A constructor for the G4NeutronHPVector class. Instantiates the class with one parameter, 
determines the value of the  \texttt nPoints variable based on input\\\hline
= & G4NeutronHPVector\& & Sets the current instance to the passed instance\\\hline
+ & G4NeutronHPVector\&, G4NeutronHPVector\& & Returns the vector addition of the two passed vectors.\\\hline
SetVerbose & G4int & sets the \texttt Verbose to the input\\\hline
Times & G4double & Multiplies \texttt theData array's y-values by the input, does the same with the corresponding 
integral\\\hline
SetPoint & G4int, G4NeutronHP-DataPoint & sets \texttt theData[G4int] to the passed in DataPoint\\\hline
SetData & G4int, G4double,G4double & sets \texttt theData[G4int] to the passed in \texttt G4double values\\\hline
SetX & G4int, G4double &  sets \texttt theData[G4int]'x value to the passed in \texttt G4double value \\\hline
SetEnergy & G4int, G4double &  sets \texttt theData[G4int]'s x value to the passed in \texttt G4double value\\\hline
SetY & G4int, G4double &  sets \texttt theData[G4int]'s y value to the passed in \texttt G4double value \\\hline
SetXsec & G4int, G4double & sets \texttt theData[G4int]'s y value to the passed in \texttt G4double value \\\hline
GetEnergy & G4int & Returns \texttt theData[G4int]'s current x value\\\hline
GetXsec & G4int &  Returns \texttt theData[G4int]'s current x value\\\hline
GetXsec & G4double &  Returns \texttt theData's y value corresponding to the x section starting at G4int\\\hline
GetX & G4int &  Returns \texttt theData[G4int]'s current x value\\\hline
GetY & G4int &  Returns \texttt theData[G4int]'s current y value\\\hline
GetVectorLength & & Returns the length of the vector, which is stored in nEntries \\\hline
GetPoint & G4int &  Returns \texttt theData[G4int]'s current value\\\hline
Hash & & sets \texttt theHash's value based on theData\\\hline
ReHash & & clears \texttt theHash and re-evaluates it based on \texttt theData \\\hline
InitInterpolation & istream & calls Init on the istream input \\\hline
Init & istream,G4int, G4double, G4double & Initializes the data in \texttt theHash of length G4int\\\hline
Init & istream, G4double,G4double & Initializes the data in \texttt theHash of length that is read in from a file\\
\hline
ThinOut & G4double & Thins out \texttt theData() by removing unnecessary elements and calls ReHash\\\hline
SetLabel & G4double & Sets the Label value to G4Double\\\hline
GetLabel & & Returns the current Label value \\\hline
CleanUp & & Sets the length of \texttt theData to 0, clears the integral and clears \texttt theHash\\\hline
Sample & & Samples X according to distribution Y \\\hline
Debug & & Returns \texttt theIntegral \\\hline
Merge & G4NeutronHPVector*,  G4NeutronHPVector* &  interpolate between labels, continue in unknown areas by subtraction     
of the last difference.\\\hline
Merge & G4Interpolation-Scheme, G4double, G4NeutronHPVector*, G4NeutronHPVector* &  interpolate between labels according     
to G4InterpolationScheme, cut at G4double, continue in unknown areas by subtraction of the last difference.\\\hline
SampleLin & & Samples X according to distribution Y, linear int\\\hline
IntegrateAndNormalise & & Calculates the integral for every entry in \texttt theIntegral and normalizes each 
calculation\\\hline
Integrate & & Calculates the integral for every entry in \texttt theIntegral \\\hline
GetIntegral & & Linear interpolation over \texttt theIntegral \\\hline+SetInterpolation-Manager & const G4Interpolation-Manager\& & sets \texttt theManager to the input\\\hline
SetInterpolation-Manager & G4Interpolation-Manager\& & sets \texttt theManager to the input \\\hline
SetScheme & G4int, G4Interpolation-Scheme\& & Appends the G4Interpolation-Scheme to \texttt theManager \\\hline
GetScheme & G4int & Returns the current  G4Interpolation-Scheme associated with \texttt theManager \\\hline
GetMeanX & & Returns the average x value of all data points in \texttt theData \\\hline
GetBlocked & & Returns the current value of \texttt theBlocked \\\hline
GetBuffered & &  Returns the current value of \texttt theBuffered \\\hline
Get15percentBorder & & gets the integral from each data point to the last data point and returns the first one within 
15\% of the last data point \\\hline
Get50percentBorder & & gets the integral from each data point to the last data point and returns the first one within 
50\% of the last data point\\
\arrayrulecolor{black}
\bottomrule
\end{longtable}

\subsubsection{State Variables}% ================== Matt
The following variables maintain state for the class, and are all private to the class.

Note that hyphens in variable names and types are just for linebreaks due to the table size. The actual variable names and types do not have hyphens.

\begin{table}[h]
\caption{G4NeutronHPVector -- state variables}\label{Table_NeutronHPDataPointStateVariables}
\begin{tabularx}{\textwidth}{p{0.2\textwidth}p{0.2\textwidth}p{0.5\textwidth}}
\toprule
\bf Variable & \bf Type & \bf Description\\\midrule
\arrayrulecolor{lightgray}
\texttt{theLin} & G4NeutronHP-Interpolator & the linear interpolator for sampling data\\\hline
\texttt{totalIntegral} & G4double & integral over all data points from \texttt{theData}\\\hline
\texttt{theData} & G4NeutronHP-DataPoint* & array of G4NeutronHPDataPoint, stores all data points in vector\\\hline
\texttt{theManager} & G4Interpolation-Manager & manages the interpolation schemes, knows how to interpolate data\\\hline
\texttt{theIntegral} & G4double* & array of integrals where \texttt{theIntegral[i]} is the integral of all data points from \texttt{theData} up until \emph{i}\\\hline
\texttt{nEntries} & G4int & the number of data points to consider when performing calculations over \texttt{theData}\\\hline
\texttt{nPoints} & G4int & the number of data points in \texttt{theData} \\\hline
\texttt{label} & G4double & number \\\hline
\texttt{theInt} & G4Neutron-Interpolator & the interpolator for sampling data (may not be linear)\\\hline
\texttt{Verbose} & G4int & verbosity level, some statements will only print to console with higher values \\\hline
\texttt{isFreed} & G4int & only used for debugging, 1 if class has been destructed 0 otherwise\\\hline
\texttt{theHash} & G4NeutronHP-Hash & stores the \emph{x} and \emph{y} value of every tenth data point from \texttt{theData} to speed up getting the minimum index in \texttt{theData} of a data point with X larger than a given value \\\hline
\texttt{maxValue} & G4double & maximum value of \texttt{Xsec} or \texttt{Y} passed in SetData, SetY, or SetXSec so far. Initialized to \texttt{-DBL\_MAX} (min representable double).\\\hline
\texttt{theBlocked} & vector \textless G4double\textgreater & deprecated: vector still exists in class but data never added to it\\\hline
\texttt{theBuffered} & vector \textless G4double\textgreater & stores buffer of samples to speed up sampling the vector \\\hline
\texttt{the15percent- BorderCash} & G4double & the X value of the first data point with an integral no more than 15\% smaller than the integral of the last data point \\\hline
\texttt{the50percent- BorderCash} & G4double & the X value of the first data point with an integral no more than 50\% smaller than the integral of the last data point\\
\arrayrulecolor{black}
\bottomrule
\end{tabularx}
\end{table}
\clearpage

\subsubsection{Environment Variables}% ============== Matt
There are no environment variables for this Module.

\subsubsection{Assumptions}% ==================== Stuart	
It can be assumed that the module will be initialized before other functions are called.

\subsection{Error Handling}
G4HadronicException

\subsection{Key Algorithms}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ---- NeutronHPVector

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ----- Cmake Files
\section{CMake Files}
\subsection{Description}
\subsection{MIS (Module Interface Specification)}
\subsubsection{Access Program Syntax}% ================ Victor
NA

\subsubsection{Access Program Semantics}% ============ Rob
NA

\subsubsection{State Variables}% ================== Matt
\begin{table}[h]
\caption{CMake Files -- state variables}\label{Table_CMakeStateVariables}
\begin{tabularx}{\textwidth}{p{0.1\textwidth}p{0.1\textwidth}p{0.7\textwidth}}
\toprule
\bf Variable & \bf Type & \bf Description\\\midrule
\texttt{useCuda} & Boolean & if set to true, the makefiles generated by CMake will include directives to compile and link the CUDA code and will execute ported procedures on the GPU. Default is false.\\
\bottomrule
\end{tabularx}
\end{table}

\subsubsection{Environment Variables}% ============== Matt
\begin{itemize}
\item NeutronHPVectorGPU.cu : CUDA file with GPU code
\end{itemize}


\subsubsection{Assumptions}% ==================== Stuart	 
No assumptions need to be made for CMake.

\subsection{Error Handling}

\subsection{Key Algorithms}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ---- Cmake Files

\end{document}
